{% extends 'user/base_user.html' %}

{% load static %}

{% block title %}
Order Details
{% endblock title %}

{% block content %}
<style>
    /* General Styles */
    .card {
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        transition: 0.3s;
        border-radius: 5px;
    }

    .card:hover {
        box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2);
    }

    img {
        border-radius: 5px 5px 0 0;
    }

    .list-group-item,
    .btn-light {
        color: black;
        font-weight: bold;
    }

    .list-group-item:hover,
    .btn-light:hover {
        color: #ff2020;
    }

    .list-group-item.active {
        color: #000000;
        background-color: #ff2020;
    }

    /* Improved spacing and layout */
    .container {
        margin-top: 20px;
    }

    .product-card {
        margin-bottom: 20px;
    }

    .shipping-address {
        padding-left: 40px;
    }

    /* Product Card Styles */
    .product-card .product-img {
        overflow: hidden;
        position: relative;
        padding: 0;
    }

    .product-card .product-img img {
        width: 100%;
        height: auto;
    }

    .product-card .card-body {
        text-align: center;
        padding: 15px;
    }

    .product-card h6 {
        font-size: 18px;
        margin: 10px 0;
        color: #333;
        /* Darker text color */
    }

    .product-card .fixed-price {
        font-size: 16px;
        font-weight: bold;
    }

    .product-card .fixed-color,
    .product-card .fixed-size {
        font-size: 14px;
        font-weight: normal;
    }

    /* Shipping Address Styles */
    .shipping-address ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .shipping-address li {
        margin-bottom: 10px;
        font-size: 16px;
        color: #444;
    }

    .shipping-address strong {
        font-weight: bold;
        color: #000;
    }

    /* Cancel Button Styles */
    .btn-cancel {
        background-color: #ff2020;
        /* Red background */
        color: white;
        /* White text */
        border: none;
        padding: 5px 15px;
        border-radius: 5px;
        cursor: pointer;
    }

    .btn-cancel:hover {
        background-color: #d60000;
        /* Darker red on hover */
    }

    /* Style for the Return Button */
    .btn-return {
        background-color: #007bff;
        /* Blue background color */
        color: white;
        /* White text color */
        border: none;
        /* Remove border */
        padding: 8px 16px;
        /* Add padding */
        border-radius: 5px;
        /* Add border radius */
        cursor: pointer;
        transition: background-color 0.3s ease;
        /* Smooth hover transition */
    }

    .btn-return:hover {
        background-color: #0056b3;
        /* Darker blue on hover */
    }

    /* Style for the Textarea Field */
    textarea {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        border: 1px solid #ccc;
        /* Add a subtle border */
        border-radius: 5px;
        /* Add border radius */
        resize: vertical;
        /* Allow vertical resizing */
        font-size: 14px;
        /* Font size */
    }

    /* Placeholder style for the Textarea */
    textarea::placeholder {
        color: #999;
        /* Placeholder text color */
    }
</style>
<div style="margin-top: 150px;">
    <div class="container">
        <div class="row">
            <section class="col-md-6">
                <div class="product-card card border-0 mb-4">
                    <div class="product-img card-header position-relative overflow-hidden bg-transparent border p-0">
                        {% for img in order_item.product.images.all %}
                        {% if forloop.first %}
                        <img class="img-fluid card-image" src="{{img.image.url }}" alt="">
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div class="card-body">
                        <h6 class="text-truncate">Product: {{ order_item.product.product }}</h6>
                        <h6 class="text-truncate">Size: {{ order_item.product.size }}</h6>
                        <h6 class="text-truncate">Category: {{ order_item.product.product.category }}</h6>
                        <h6 class="text-truncate">Color: {{ order_item.product.color }}</h6>
                        <h6 class="text-truncate">Price: {{ order_item.order.total_price_tax }}</h6>
                        <h6 class="text-truncate">Payment Method: {{ order_item.order.payment_method }}</h6>
                        <h6 class="text-truncate">Order Status: {{ order_item.order_status }}</h6>
                        {% if order_item.order_status == 'Return Requested' %}
                        <h6>Reason: {{order_item.return_reason}}</h6>
                        {% endif %}
                        {% if order_item.order_status == 'Order Placed' or order_item.order_status == 'Shipped' %}
                        <form method="post" action="{% url 'cancel_order' order_item.order.id order_item.product.id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-cancel">CANCEL</button>
                        </form>
                        {% elif order_item.order_status == 'Delivered' %}
                        <input type="checkbox" id="return_checkbox">
                        <label for="return_checkbox" class="form-label">Want to Return</label>
                        <div id="return_section">
                            <form method="post"
                                action="{% url 'return_order' order_item.order.id order_item.product.id %}">
                                {% csrf_token %}
                                <label for="return_reason" class="form-label">REASON FOR RETURN</label>
                                <textarea class="form-control" id="return_reason" name="return_reason" rows="4"
                                    placeholder="Enter your reason for return" required></textarea>
                                <button type="submit" class="btn btn-sm btn-return">RETURN</button>
                                <div class="col-md-6"></div>
                            </form>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </section>
            <div class="col-md-3 mt-2 mb-4 ml-5">
                <div class="card shipping-address ml-auto" style="width: 350px;">
                    <h4 class="mb-3"><strong>SHIPPING ADDRESS</strong></h4>
                    <ul>
                        <li><strong>Name :</strong> {{ order.address.user }}</li>
                        <li><strong>Phone :</strong> {{ order.address.user.phone_number }}</li>
                        <li><strong>House :</strong> {{ order.address.name }}</li>
                        <li><strong>Street :</strong> {{ order.address.street }}</li>
                        <li><strong>City :</strong> {{ order.address.city }}</li>
                        <li><strong>State :</strong> {{ order.address.state }}</li>
                        <li><strong>Country :</strong> {{ order.address.country }}</li>
                        <li><strong>Pin code :</strong> {{ order.address.pin_code }}</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Get references to the checkbox and return section
        const returnCheckbox = document.getElementById("return_checkbox");
        const returnSection = document.getElementById("return_section");

        // Function to toggle the visibility of the return section
        function toggleReturnSection() {
            if (returnCheckbox.checked) {
                returnSection.style.display = "block";
            } else {
                returnSection.style.display = "none";
            }
        }

        // Add an event listener to the checkbox to trigger the toggle function
        returnCheckbox.addEventListener("change", toggleReturnSection);

        // Initial call to set the initial visibility based on checkbox state
        toggleReturnSection();
    });
</script>
{% endblock content %}