{% extends 'user/base_user.html' %}

{% block content %}
<style>
    .carousel-image {
        object-fit: cover;
        width: auto;
        /* Change this value to the desired width */
        height: 360px;
    }
</style>
<div style="margin-top: 200px;">
    <div class="content_wrapper mt-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-7">
                    <div id="productImageCarousel" class="carousel slide product_image_large" data-ride="carousel">
                        <div class="carousel-inner">
                            {% for image in variants.0.images.all %}
                            <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                <img src="{{ image.image.url }}" class="d-block w-100 carousel-image" alt="" />
                            </div>
                            {% endfor %}
                        </div>
                        <a class="carousel-control-prev" href="#productImageCarousel" role="button" data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="carousel-control-next" href="#productImageCarousel" role="button" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>
                </div>
                <div class="col-lg-5">
                    <div class="product_content">
                        <h2 class="font-weight-bold" id="product_name">{{ variants.0.product.name }}</h2>
                        <div class="product_price" id="product_price">&#8377; {{ variants.0.offer_price }}</div>
                        <div class="product_offer_price" id="product_offer_price"><del>&#8377;
                                {{variants.0.price}}</del></div>
                        <div class="in_stock_container mt-2">
                            <div class="in_stock in_stock_true"></div>
                            <span class="font-weight-bold">in stock</span>
                        </div>
                        <div class="product_text mt-3">
                            <p>{{ products.description }}</p>
                        </div>
                        <div class="d-flex align-items-center">
                            <div class="dropdown mr-3">
                                <button class="btn btn-outline-dark" type="button" id="sizeDropdown"
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Select Size
                                </button>
                                <div class="dropdown-menu" aria-labelledby="sizeDropdown">
                                    <div class="dropdown-header">Select Size</div>
                                    {% for size in sizes %}
                                    <a class="dropdown-item" href="#">
                                        <input type="radio" id="size_radio_{{ size.id }}" name="selected_size"
                                            class="regular_radio radio_size" value="{{ size.id }}" />
                                        <label for="size_radio_{{ size.id }}">{{ size.name }}</label>
                                    </a>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-outline-dark" type="button" id="colorDropdown"
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Select Color
                                </button>
                                <div class="dropdown-menu" aria-labelledby="colorDropdown">
                                    <div class="dropdown-header">Select Color</div>
                                    {% for color in colors %}
                                    <a class="dropdown-item" href="#">
                                        <input type="radio" id="color_radio_{{ color.id }}" name="selected_color"
                                            class="regular_radio radio_color" value="{{ color.id }}" />
                                        <label for="color_radio_{{ color.id }}">{{ color.name }}</label>
                                    </a>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        <div class="product_size_container mt-3">
                            <button class="button cart_button mt-3 text-center" style="padding: 1px 15px;"><a
                                    href="#">add to cart</a></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        // Function to update product details based on selected size and color
        function updateProductDetails() {
            var selectedSize = $("input[name='selected_size']:checked").val();
            var selectedColor = $("input[name='selected_color']:checked").val();

            // Make an AJAX request to your view function with the selected size and color
            $.ajax({
                type: "GET",
                url: "{% url 'product_description' products.id %}",
                data: {
                    selected_size: selectedSize,
                    selected_color: selectedColor
                },
                success: function (data) {
                    // Update the product details on the page
                    $("#product_name").text(data.products.name);
                    $("#product_price").text("₹ " + data.variants[0].offer_price);
                    $("#product_offer_price").html("<del>₹ " + data.variants[0].price + "</del>");
                    // Update other product details as needed

                    // Update the carousel images based on the selected color
                    updateCarouselImages(data.variants[0].color_image_urls);
                }
            });
        }

        // Function to update carousel images
        function updateCarouselImages(imageUrls) {
            var carouselInner = $("#productImageCarousel .carousel-inner");
            carouselInner.empty(); // Clear existing images

            // Append new images based on the selected color
            for (var i = 0; i < imageUrls.length; i++) {
                var image = $("<img>").addClass("d-block w-100 carousel-image");
                image.attr("src", imageUrls[i]);

                var carouselItem = $("<div>").addClass("carousel-item");
                if (i === 0) {
                    carouselItem.addClass("active");
                }

                carouselItem.append(image);
                carouselInner.append(carouselItem);
            }
        }

        // Attach change event handlers to the radio buttons
        $("input[name='selected_size'], input[name='selected_color']").change(function () {
            updateProductDetails();
        });

        // Initialize product details
        updateProductDetails();
    });
</script>
{% endblock %}